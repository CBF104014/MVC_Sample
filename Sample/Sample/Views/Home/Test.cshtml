@{
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" id="Back">
	<br />
	<br />
	<br />
	
	<div class="form-group">
		<div class="card">
			<div class="card-body overflow-auto" id="discussion" style="height:10rem;">
			</div>
		</div>
		<div class="form-group form-inline mt-3">
			<label class="form-control">@ViewBag.UserId</label>
			<input type="text" class="form-control" id="message" />
			<input type="button" class="btn btn-primary" id="sendmessage" value="Send" />
			<input type="hidden" class="form-control" id="displayname" />
		</div>
		
		@*<ul id="discussion"></ul>*@
	</div>
</div>
@section Scripts {
	@Scripts.Render("/signalr/hubs")
}
<script>
	document.addEventListener("DOMContentLoaded", function () {
		$(function () {
			// Declare a proxy to reference the hub.
			var chat = $.connection.chatHub;
			// Create a function that the hub can call to broadcast messages.
			chat.client.broadcastMessage = function (name, message) {
				// Html encode display name and message.
				var encodedName = $('<div />').text(name).html();
				var encodedMsg = $('<div />').text(message).html();
				// Add the message to the page.
				$('#discussion').append(`
					${encodedName}: 
					<label class="alert alert-secondary" role="alert">
					  ${encodedMsg}
					</label><br>
					`);
				//$('#discussion').append('<li><strong>' + encodedName
				//	+ '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
			};
			// Get the user name and store it to prepend to messages.
			$('#displayname').val('@ViewBag.UserId');
			// Set initial focus to message input box.
			$('#message').focus();
			// Start the connection.
			$.connection.hub.start().done(function () {
				$('#sendmessage').click(function () {
					// Call the Send method on the hub.
					chat.server.send($('#displayname').val(), $('#message').val());
					// Clear text box and reset focus for next comment.
					$('#message').val('').focus();
				});
			});
		});
	});
</script>